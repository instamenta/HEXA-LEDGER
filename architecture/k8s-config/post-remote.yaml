
apiVersion: v1
kind: ConfigMap
metadata:
  name: post-remote-configmap
data:
  ROUTER_PORT: "50052"
  SERVICE_NAME: 'hexagots-post-remote-api'
  MONGODB_URI: "mongodb+srv://janoopsi:janoopsi9999@clickercluster.ltycehn.mongodb.net/?retryWrites=true&w=majority"
  TOKEN_SECRET: "SECRET"
  DEBUG_CONSOLE: "true"
---

apiVersion: v1
kind: Secret
metadata:
  name: post-remote-secret
type: Opaque
#data:
#  - MONGODB_URI: "mongodb+srv://janoopsi:janoopsi9999@clickercluster"

---

apiVersion: v1
kind: Service
metadata:
  name: post-remote-service
  labels:
    app: post-remote-api
spec:
  type: NodePort
  selector:
    app: post-remote-api
  ports:
    - protocol: TCP
      port: 50052
      targetPort: 50052
      nodePort: 30091

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: post-remote-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: post-remote-api
  template:
    metadata:
      labels:
        app: post-remote-api
    spec:
      containers:
        - name: post-remote-api
          image: janoopsi/post-remote-api:latest
          imagePullPolicy: Always
          ports:
            - containerPort: 50052
          env:
            - name: ROUTER_PORT
              valueFrom:
                configMapKeyRef:
                  name: post-remote-configmap
                  key: ROUTER_PORT
            - name:  MONGODB_URI
              valueFrom:
                configMapKeyRef:
                  name: post-remote-configmap
                  key: MONGODB_URI
            - name: SERVICE_NAME
              valueFrom:
                configMapKeyRef:
                  name: post-remote-configmap
                  key: SERVICE_NAME
            - name: TOKEN_SECRET
              valueFrom:
                configMapKeyRef:
                  name: post-remote-configmap
                  key: TOKEN_SECRET
            - name: DEBUG_CONSOLE
              valueFrom:
                configMapKeyRef:
                  name: post-remote-configmap
                  key: DEBUG_CONSOLE

